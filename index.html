<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Digilink IT Solutions Operations Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: white;
      margin: 0;
      padding: 0;
    }

    header {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      padding: 10px 20px;
      background: rgba(0,0,0,0.7);
    }

    header img {
      height: 150px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      background-color: #1e3a5f;
    }

    .tab-button {
      padding: 15px 30px;
      background: #2d5d86;
      border: none;
      cursor: pointer;
      color: white;
      font-size: 16px;
      transition: background 0.3s ease;
    }

    .tab-button:hover, .tab-button.active {
      background: #4e8dc4;
    }

    .header-blue {
    color: #4caf50;
    text-align: center;
}


    .tab-content {
      display: none;
      padding: 20px;
    }

    .tab-content.active {
      display: block;
    }

    .section {
      margin-bottom: 30px;
    }

    input, select, button {
      padding: 5px 10px;
      margin: 5px;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      background-color: white;
      color: black;
    }

    button {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    /* New styles for aligned input fields */
    .field-group {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 400px;
      margin-bottom: 15px;
      margin-left: auto;
      margin-right: auto;
    }
    .field-group label {
      flex: 1 0 60%;
      text-align: right;
      padding-right: 15px;
      font-weight: bold;
    }
    .field-group input {
      flex: 1 0 35%;
      padding: 8px 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
      outline: none;
    }
  </style>
</head>
<body>
  <header>
    <img src="FullLogo.jpg" alt="Digilink Logo" />
    <div>
      <button class="tab-button active" onclick="switchTab('expenditureTab')">Expenditure</button>
      <button class="tab-button" onclick="switchTab('taskTab')">Task Log</button>
    </div>
  </header>

  <div id="expenditureTab" class="tab-content active">
    <h2 class="header-blue">Digilink IT Solutions Monthly Expenditure Tracker</h2>


    <div class="field-group">
      <label for="staticIncome">Static Monthly Income (R):</label>
      <input type="number" id="staticIncome" value="2000" onchange="calculateExpenditure()" />
    </div>

    <div class="field-group">
      <label for="jobIncome">Job Income for this month (R):</label>
      <input type="number" id="jobIncome" value="0" onchange="calculateExpenditure()" />
    </div>

    <div class="field-group">
      <label for="mailboxCost">Office 365 Mailbox x1 (R):</label>
      <input type="number" id="mailboxCost" value="82.71" onchange="calculateExpenditure()" />
    </div>

    <div id="extraExpenses" style="max-width: 400px; margin: 0 auto;"></div>

    <div style="text-align:center; margin-bottom: 20px;">
      <button onclick="addExpense()">Add Expense</button>
    </div>

    <div class="section" style="max-width: 400px; margin: 0 auto; text-align:center;">
      <h3>Total Expenses: R <span id="totalExpenses">82.71</span></h3>
      <h3>Total Income: R <span id="totalIncome">2000.00</span></h3>
      <h3>Net Income: R <span id="netIncome">1917.29</span></h3>
    </div>

    <div style="text-align:center;">
      <button onclick="exportExpenditureCSV()">Export CSV</button>
    </div>
  </div>

  <div id="taskTab" class="tab-content">
    <h2 class="header-blue" style="text-align:center;">Digilink IT Solutions Monthly Task Log</h2>
    <table id="taskTable">
      <thead>
        <tr>
          <th>Task</th>
          <th>Description</th>
          <th>Date</th>
          <th>Start Time</th>
          <th>Finish Time</th>
          <th>Total Hours</th>
          <th>Rate per Hour</th>
          <th>Income</th>
        </tr>
      </thead>
      <tbody id="taskBody">
        <tr>
          <td><input type="text" /></td>
          <td><input type="text" /></td>
          <td><input type="date" /></td>
          <td><input type="time" /></td>
          <td><input type="time" /></td>
          <td><input type="text" readonly /></td>
          <td><input type="number" step="0.01" value="500.00" /></td>
          <td><input type="text" readonly /></td>
        </tr>
      </tbody>
    </table>
    <div style="text-align:center; margin-top: 15px;">
      <button onclick="addTask()">Add Task</button>
      <button onclick="calculateTasks()">Calculate</button>
      <button onclick="exportTasks()">Export CSV</button>
    </div>
    <div style="text-align:center; margin-top: 15px;">
       <h3>Total Hours: <span id="totalTaskHours">0</span></h3>
      <h3>Total Income: <span id="totalTaskIncome">R 0.00</span></h3>
    </div>
  </div>

  <script>
    function switchTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
      document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
      event.target.classList.add("active");
    }

    // Calculate total income, expenses, net income for expenditure tab
    function calculateExpenditure() {
      let staticIncome = parseFloat(document.getElementById("staticIncome").value) || 0;
      let jobIncome = parseFloat(document.getElementById("jobIncome").value) || 0;
      let totalIncome = staticIncome + jobIncome;

      let mailboxCost = parseFloat(document.getElementById("mailboxCost").value) || 0;
      let extraTotal = 0;
      document.querySelectorAll(".extraExpense").forEach(input => {
        extraTotal += parseFloat(input.value) || 0;
      });
      let totalExpenses = mailboxCost + extraTotal;

      document.getElementById("totalExpenses").innerText = totalExpenses.toFixed(2);
      document.getElementById("totalIncome").innerText = totalIncome.toFixed(2);
      document.getElementById("netIncome").innerText = (totalIncome - totalExpenses).toFixed(2);
    }

    // Add extra expense input field
    function addExpense() {
      const container = document.getElementById("extraExpenses");
      const input = document.createElement("input");
      input.type = "number";
      input.placeholder = "New Expense (R)";
      input.className = "extraExpense";
      input.onchange = calculateExpenditure;
      input.style.display = "block";
      input.style.margin = "10px auto";
      input.style.width = "150px";
      container.appendChild(input);
    }

    // Export expenditure CSV
    function exportExpenditureCSV() {
      const rows = [
        ["Static Income", document.getElementById("staticIncome").value],
        ["Job Income", document.getElementById("jobIncome").value],
        ["Office 365 Mailbox", document.getElementById("mailboxCost").value],
        ...Array.from(document.querySelectorAll(".extraExpense")).map((el, i) => [`Extra Expense ${i+1}`, el.value]),
        ["Total Expenses", document.getElementById("totalExpenses").innerText],
        ["Total Income", document.getElementById("totalIncome").innerText],
        ["Net Income", document.getElementById("netIncome").innerText]
      ];
      let csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "expenditure.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Add new task row in task tab
    function addTask() {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" /></td>
        <td><input type="text" /></td>
        <td><input type="date" /></td>
        <td><input type="time" /></td>
        <td><input type="time" /></td>
        <td><input type="text" readonly /></td>
        <td><input type="number" step="0.01" value="500.00" /></td>
        <td><input type="text" readonly /></td>
      `;
      document.getElementById("taskBody").appendChild(row);
    }

    // Calculate hours and income for each task row
    function calculateTasks() {
  const rows = document.querySelectorAll("#taskBody tr");
  let totalHours = 0;
  let totalIncome = 0;

  rows.forEach(row => {
    const start = row.children[3].children[0].value;
    const end = row.children[4].children[0].value;
    const rate = parseFloat(row.children[6].children[0].value) || 0;
    if (start && end) {
      const [sh, sm] = start.split(":").map(Number);
      const [eh, em] = end.split(":").map(Number);
      let startMins = sh * 60 + sm;
      let endMins = eh * 60 + em;
      let diff = (endMins - startMins) / 60;
      diff = diff < 0 ? 0 : diff;
      row.children[5].children[0].value = diff.toFixed(2);
      const income = diff * rate;
      row.children[7].children[0].value = "R " + income.toFixed(2);

      totalHours += diff;
      totalIncome += income;
    }
  });

  document.getElementById("totalTaskHours").textContent = totalHours.toFixed(2);
  document.getElementById("totalTaskIncome").textContent = "R " + totalIncome.toFixed(2);
}


    // Export tasks to CSV
    function exportTasks() {
  const rows = document.querySelectorAll("#taskBody tr");
  let csv = "Client,Task,Date,Start,End,Hours,Rate,Income\n";
  let totalHours = 0;
  let totalIncome = 0;

  rows.forEach(row => {
    const data = [];
    for (let i = 0; i < 8; i++) {
      let val = row.children[i].children[0].value || "";
      if (i === 7 && val.startsWith("R ")) val = val.slice(2); // remove "R " from income
      data.push(val.replace(/,/g, "")); // remove commas to avoid breaking CSV
    }
    csv += data.join(",") + "\n";

    totalHours += parseFloat(data[5]) || 0;
    totalIncome += parseFloat(data[7]) || 0;
  });

  // Add totals row
  csv += `,,,,Total,${totalHours.toFixed(2)},,${totalIncome.toFixed(2)}\n`;

  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "task_log.csv";
  a.click();
}


    window.onload = calculateExpenditure;
  </script>
</body>
</html>
